{% extends './base.html' %}
{% load static %}

{% block title %}
    Weddingram
{% endblock title %}

{% block search-block %}
<audio src="{% static '/images/DestinyOfLove.m4a' %}" class="audio" controls autoplay loop />
{% endblock search-block %}

{% block homemenu %}
    <!--a href="/main/"><img src="{% static 'images/svg/home_now.svg' %}" class="home" alt=""></a-->
    <img src="{% static 'images/svg/posting.svg' %}" id="ad_fd" class="postc" alt="">
{% endblock homemenu %}

{% block main-block %}
        <main>
        <div class="main-sub">
            <!-- ë©”ì¸í”¼ë“œ ì˜ì—­ -->
            <section class="main-feed">
                <div class="wrapper">
                    <!-- ì¢Œì¸¡ ê·¸ë¦¬ë“œ -->
                    <div class="left-col">
                        <!-- ìŠ¤í† ë¦¬ ì‹œì‘ -->
                        <div class="status-wrapper">
                            <div class="status-card">
                                <div class="profile-pic2" onclick="document.location.href='sms:01031214123'"><img src="{% static 'images/marc_profile.png' %}" alt=""></div>
                                <p class="s_username">ì‹ ë‘ì—ê²Œ</br>ë¬¸ìí•˜ê¸°</p>
                            </div>
                            <div class="status-card">
                                <div class="profile-pic2" onclick="document.location.href='sms:01033546776'"><img src="{% static 'images/jane_profile.png' %}" alt=""></div>
                                <p class="s_username">ì‹ ë¶€ì—ê²Œ</br>ë¬¸ìí•˜ê¸°</p>
                            </div>
                            <div class="status-card">
                                <div class="profile-pic2" onclick="location.href='{% url 'content:location' %}'"><img src="{% static 'images/map.png' %}" alt=""></div>
                                <p class="s_username">ì°¾ì•„ì˜¤ì‹œëŠ” ê¸¸</p>
                            </div>
                            <div class="status-card" onclick="javascript:void(0);" id="btn">
                                <div class="profile-pic2-off"/><img src="{% static 'images/share.png' %}" alt=""></div>
                                <p class="s_username">ì¹´ì¹´ì˜¤í†¡</br>ê³µìœ í•˜ê¸°</p>
                            </div>
                            <div class="status-card">
                                <div class="profile-pic2-off" onclick="location.href='{% url 'content:about' %}'"><img src="{% static 'images/cat_jane_small.png' %}" alt=""></div>
                                <p class="s_username">ì œì‘í›„ê¸°</p>
                            </div>
                            <div class="status-card">
                                <div class="profile-pic2-off" onclick="location.href='{% url 'content:copyright' %}'"><img src="{% static 'images/copy.png' %}" alt=""></div>
                                <p class="s_username">ì €ì‘ê¶Œ ì •ë³´</p>
                            </div>
                        </div>
                        <!-- ìŠ¤í† ë¦¬ ë -->

                        <!-- ìƒë‹¨ ê³µì§€ í¬ìŠ¤íŠ¸ ì‹œì‘ -->
                        <div class="post">
                            <div class="info">
                                <div class="user">
                                    <div class="profile-pic2"><img src="{% static 'images/weddingram_profile.png' %}" alt=""></div>
                                    <p class="feed_username">Weddingram</p>
                                </div>
                                <div class="openPopup"><img src="{% static './images/svg/options.svg' %}" alt=""></div>
                            </div>
                            <iframe width="100%" height="338" src="https://www.youtube.com/embed/1sPOksD7GPc" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                            <div class="post-content">
                                <div class="reaction-wrapper">
                                    <img src="{% static 'images/svg/like.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/comments.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/messenger.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/saved.svg' %}" class="save icon" alt="">
                                </div>
                                <p class="likes">
                                <div class="comment-wrapper">
                                    <div class="profile-pic2"><img src="{% static 'images/marcngine.jpg' %}" alt=""></div>
                                    <div class="subtrack"><span>marcngine</span>ë‹˜ <span>ì™¸ ì—¬ëŸ¬ ëª…</span>ì´ ì¢‹ì•„í•©ë‹ˆë‹¤</div>
                                </div>
                                </p>
                                <p class="description"><span class="writer">Weddingram</span></p>
                                <p class="tag">#ì›¨ë”©ê·¸ë¨ #weddingram #animated #movie #í”„ë¡œí¬ì¦ˆ #í”„ë¡œí¬ì¦ˆì˜ìƒ</p>
                                <p class="post-time">2022.04.13</p>
                            </div>
                        </div>
                        <!-- ìƒë‹¨ ê³µì§€ í¬ìŠ¤íŠ¸ ë -->

                        <!-- ì²­ì²©ì¥ í¬ìŠ¤íŠ¸ ì‹œì‘ -->
                        <div class="post">
                            <div class="info">
                                <div class="user">
                                    <div class="profile-pic2"><img src="{% static 'images/weddingram_profile.png' %}" alt=""></div>
                                    <p class="feed_username">Weddingram</p>
                                </div>
                                <div class="openPopup"><img src="{% static './images/svg/options.svg' %}" alt=""></div>
                            </div>
                            <img src="{% static 'images/wedding_invitation2.png' %}" class="post-image" alt="">
                            <div class="post-content">
                                <div class="reaction-wrapper">
                                    <img src="{% static 'images/svg/like.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/comments.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/messenger.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/saved.svg' %}" class="save icon" alt="">
                                </div>
                                <p class="likes">
                                <div class="comment-wrapper">
                                    <div class="profile-pic2"><img src="{% static 'images/marcngine.jpg' %}" alt=""></div>
                                    <div class="subtrack"><span>marcngine</span>ë‹˜ <span>ì™¸ ì—¬ëŸ¬ ëª…</span>ì´ ì¢‹ì•„í•©ë‹ˆë‹¤</div>
                                </div>
                                </p>
                                <p class="description"><span class="writer">Weddingram</span><br>
                                    ë‚´ ê·¸ëŒ€ë¥¼ ìƒê°í•¨ì€<br>
                                    í•­ìƒ ê·¸ëŒ€ê°€ ì•‰ì•„ ìˆëŠ” ë°°ê²½ì—ì„œ<br>
                                    í•´ê°€ ì§€ê³  ë°”ëŒì´ ë¶€ëŠ” ì¼ì²˜ëŸ¼ ì‚¬ì†Œí•œ ì¼ì¼ ê²ƒì´ë‚˜<br>
                                    ì–¸ì  ê°€ ê·¸ëŒ€ê°€<br>
                                    í•œì—†ì´ ê´´ë¡œì›€ ì†ì„ í—¤ë§¤ì¼ ë•Œì—<br>
                                    ì˜¤ë«ë™ì•ˆ ì „í•´ ì˜¤ë˜ ê·¸ ì‚¬ì†Œí•¨ìœ¼ë¡œ<br>
                                    ê·¸ëŒ€ë¥¼ ë¶ˆëŸ¬ë³´ë¦¬ë¼.<br><br>
                                    ì´ˆì—¬ë¦„ì´ ì‹œì‘ë˜ëŠ” 2022ë…„ 6ì›” 11ì¼, í† ìš”ì¼ ì •ì˜¤.<br>
                                    ê³ ì¦ˆë„‰í•œ ì„œê³„ì¢…íƒì—ì„œ ë¶€ë¶€ì˜ ì—°ì„ ë§ºê³ ì í•©ë‹ˆë‹¤.<br>
                                    ì§ì ‘ ì˜¤ì‹œì§€ ëª»í•˜ë”ë¼ë„ ê´œì°®ìŠµë‹ˆë‹¤.<br>
                                    ì €í¬ì˜ ì‹œì‘ì„ ë©€ë¦¬ì„œ ë§ˆìŒë§Œì´ë¼ë„ í•¨ê»˜ ì¶•ë³µí•´ ì£¼ì‹œë©´ ê°ì‚¬ë“œë¦¬ê² ìŠµë‹ˆë‹¤.
                                </p>
                                <p class="post-time">2022.06.11</p>
                            </div>
                        </div>
                        <!-- ì²­ì²©ì¥ í¬ìŠ¤íŠ¸ ë -->

                        {% for feed in feed_list %}
                        <!-- í”¼ë“œ í¬ìŠ¤íŠ¸ ì‹œì‘ -->
                        <div class="post">
                            <div class="info">
                                <div class="user">
                                    <div class="profile-pic2"><img src="{% static 'images/weddingram_profile.png' %}" alt=""></div>
                                    <p class="feed_username">Weddingram</p>
                                </div>
                                <div class="openPopup"><img src="{% static 'images/svg/options.svg' %}" alt=""></div>
                            </div>
                            <img src="{% get_media_prefix %}{{ feed.image }}" class="post-image" alt="">
                            <div class="post-content">
                                <div class="reaction-wrapper">
                                    <img src="{% static 'images/svg/like.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/comments.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/messenger.svg' %}" class="icon" alt="">
                                    <img src="{% static 'images/svg/saved.svg' %}" class="save icon" alt="">
                                </div>
                                <p class="likes">
                                    <div class="comment-wrapper">
                                        <div class="profile-pic2"><img src="{% static 'images/weddingram_profile.png' %}" alt="/"></div>
                                        <div class="subtrack"><span>Weddingram</span>ë‹˜ <span>ì™¸ 1ëª…</span>ì´ ì¢‹ì•„í•©ë‹ˆë‹¤</div>
                                    </div>
                                </p>
                                <p class="description"><span class="writer">feed id</span>
                                    {{ feed.content|linebreaksbr }}
                                </p>
                                <p class="tag">
                                    {{ feed.tag }}
                                </p>
                                <p>
                                    <div id="reply_list_{{ feed.id }}">
                                        {% for reply in feed.reply_list %}
                                            <div class="dep2"><span class="writer">{{ reply.writer_id }}</span> {{ reply.comment }}</div>
                                        {% endfor %}
                                    </div>
                                </p>
                                <p class="post-time">{{ feed.write_date }}</p>
                            </div>
                            <div class="comment-write">
                                <img src="{% static 'images/svg/smile.svg' %}" class="icon" alt="">
                                <input id="name_{{ feed.id }}" type="text" class="name-box" placeholder="ì´ë¦„">
                                <input id="reply_{{ feed.id }}" type="text" class="comment-box" placeholder="ëŒ“ê¸€ ë‹¬ê¸°...">
                                <button feed_id="{{ feed.id }}" style="width:40px;height:100%;font-weight:500;background:none;border:none;outline:none;text-transform:capitalize;font-size:14px;text-align:center;color:rgb(0, 162, 255);opacity:1;cursor:pointer;" class="upload_reply">ê²Œì‹œ</button>
                            </div>
                        </div>
                        <!-- í”¼ë“œ í¬ìŠ¤íŠ¸ ë -->
                        {% endfor %}

                    </div>
                    <!-- ìš°ì¸¡ ê·¸ë¦¬ë“œ -->
                    <div class="right-col">
                        <!-- í”„ë¡œí•„ ì˜ì—­ -->
                        <div class="cardarea">
                            <div class="image">
                                <img src="{% static 'images/weddingram_profile.png' %}" alt="">
                            </div>
                            <div class="center">
                                <p class="username">Weddingram</p>
                                <p class="sub-text_o">2022.06.11(Sat), 12 P.M.</p>
                            </div>
                        </div>
                        <!-- ì¶”ì²œ ì˜ì—­ -->
                        <p class="suggestion-text">íšŒì›ë‹˜ì„ ìœ„í•œ ì¶”ì²œ</p>
                        <div class="profile-card">
                            <div class="image2">
                                <img src="{% static 'images/marcngine.jpg' %}" title="marcngineë‹˜ì˜ í”„ë¡œí•„ì‚¬ì§„" alt="">
                            </div>
                            <div class="center2">
                                <p class="username">marcngine</p>
                                <p class="sub-text">_your_janeë‹˜ì´ íŒ”ë¡œìš°í•©ë‹ˆë‹¤</p>
                            </div>
                            <div class="right"><button class="action-btn"><a href="https://www.instagram.com/marcngine/" target="_blank">ë°©ë¬¸</a></button></div>
                        </div>
                        <div class="profile-card">
                            <div class="image2">
                                <img src="{% static 'images/your_jane.jpeg' %}" title="_your_janeë‹˜ì˜ í”„ë¡œí•„ì‚¬ì§„" alt="">
                            </div>
                            <div class="center2">
                                <p class="username">_your_jane</p>
                                <p class="sub-text">marcngineë‹˜ì´ íŒ”ë¡œìš°í•©ë‹ˆë‹¤</p>
                            </div>
                            <div class="right"><button class="action-btn"><a href="https://www.instagram.com/_your_jane/" target="_blank">ë°©ë¬¸</a></button></div>
                        </div>
                        <!-- í‘¸í„° ì˜ì—­ -->
                        <footer>
                        {% endblock main-block %}
                        {% block footer %}
                        </footer>
                    </div>
                    <!-- ìš°ì¸¡ ê·¸ë¦¬ë“œ ë -->
                </div>
            </section>
        </div>
        </main>
        {% endblock footer %}

        {% block modal-block %}
        <!-- í¬ìŠ¤íŒ… ëª¨ë‹¬ -->
        <div id="md_ad_fd" class="modal m_overlay">
            <div class="m_window">
                <div class="modal_title">
                    <div class="modal_title_side"></div>
                    <div> ìƒˆ í¬ìŠ¤íŒ… </div>
                    <div class="modal_title_side">
                        <span id="close_modal" class="close_modal" style="font-size: 10px">
                            close
                        </span>
                    </div>
                </div>
                <div class="modal_image_upload">
                    <span style="text-align: center"> ì‚¬ì§„ì„ ì—¬ê¸°ì— ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”. </span>
                </div>
            </div>
        </div>

        <div id="modal_add_feed_content" class="modal modal_overlay_content">
            <div class="m_window">
                <div class="modal_title">
                    <div class="modal_title_side"></div>
                    <div style="margin:5px"> ìƒˆ í¬ìŠ¤íŒ… </div>
                    <div class="modal_title_side">
                        <span id="close_modal" class="close_modal" style="font-size:10px">
                            close
                        </span>
                    </div>
                </div>
                <div class="modal_image_content">
                    <div id="input_image" class="modal_image_upload_content">

                    </div>
                    <div class="modal_content_write">
                        <div class="feed_name">
                            <div class="profile_box">
                                <img id="input_profile_image" class="profile_img" src="{% static 'images/weddingram_profile.png' %}" style="width:24px;height:24px;" alt="">
                            </div>
                            <span id="input_user_id" class="feed_name_txt">Marc</span>
                        </div>
                        <div style="height: 345px">
                            <textarea id="input_content" class="feed_content_textarea" rows="20" placeholder="ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <div style="height: 100px">
                            <textarea id="input_tag" class="feed_content_textarea" rows="5" placeholder="íƒœê·¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <div style="width: 100%; text-align: center">
                            <button id="button_write_feed" type="button" class="btn btn-primary" style="width: 268px"> ì‘ì„±í•˜ê¸°</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
        <!-- í¬ìŠ¤íŒ… ëª¨ë‹¬ ë -->

        <!-- ì˜µì…˜íŒì—… -->
        <div id="popup">
            <div id="popup_g">
                <div id="modal">
                    <button id="m_btn1" tabindex="0" onclick="ale1()">ì‹ ê³ </button>
                    <button id="m_btn2" tabindex="1" onclick="ale2()">íŒ”ë¡œìš° ì·¨ì†Œ</button>
                    <button id="m_btn3" tabindex="2" class="close">ì·¨ì†Œ</button>
                </div>
            </div>
        </div>

        {% endblock modal-block %}

        {% block script-block %}
        <script>

            $(".upload_reply").click(function (event){
                let feed_id = event.target.attributes.getNamedItem('feed_id').value;
                let reply_id = 'reply_' + feed_id;
                let name_id = 'name_' + feed_id;
                let writer_id = $('#'+name_id).val();
                let comment = $('#'+reply_id).val();

                if(comment.length <= 0){
                    alert("ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”");
                    return 0;
                }

                if(writer_id.length <= 0){
                    alert("ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”");
                    return 0;
                }

                $.ajax({
                url: "/content/reply",
                data: {
                    feed_id : feed_id,
                    writer_id : writer_id,
                    comment : comment
                },
                method: "POST",
                success: function (data) {
                    console.log("ëŒ“ê¸€ì„±ê³µ");
                    $("#reply_list_"+feed_id).append("<div class='dep2'>ğŸ‘ <span class='writer'>" + writer_id + "</span> " + comment + " </div>")
                    {#location.replace('/main');#}
                },
                error: function (request, status, error) {
                    console.log("ëŒ“ê¸€ì—ëŸ¬");
                },
                complete: function() {
                    console.log("ì™„ë£Œ");
                    $('#'+reply_id).val('');
                    $('#'+name_id).val('');
                }
            });

            });

        const md = document.getElementById("md_ad_fd");
        const buttonAddFeed = document.getElementById("ad_fd");
        buttonAddFeed.addEventListener("click", e => {
            md.style.top = window.pageYOffset + 'px'; // topì„ ì´ìš©í•´ ì‹œì‘ yìœ„ì¹˜ë¥¼ ë°”ê¿”ì¤Œ
            md.style.display = "flex";
            document.body.style.overflowY = "hidden"; // ìŠ¤í¬ë¡¤ ì—†ì• ê¸°
        });

        // ëª¨ë‹¬ ë‹«ê¸° ì½”ë“œ
        const buttonCloseModal = document.getElementById("close_modal");
        buttonCloseModal.addEventListener("click", e => {
            md.style.display = "none";
            document.body.style.overflowY = "visible";
        });

        <!-- jquery ë¶€ë¶„ -->
        $('.close_modal').on("click", () => {
            closeModal();
        });

        function closeModal() {
            $('.modal').css({
                display : 'none'
            });
            $(document.body).css({
                overflowY : 'visible'
            });
        };

        $('.modal_image_upload')
            .on("dragover", dragOver)
            .on("dragleave", dragOver)
            .on("drop", uploadFiles);

        function dragOver(e){
            e.stopPropagation();
            e.preventDefault();

            if (e.type == "dragover") {
                $(e.target).css({
                    "background-color": "black",
                    "outline-offset": "-20px"
                });
            }
            else {
                $(e.target).css({
                    "background-color": "white",
                    "outline-offset": "-10px"
                });
            }
        }

        function uploadFiles(e){
            e.stopPropagation();
            e.preventDefault();
            console.log(e.dataTransfer)
            console.log(e.originalEvent.dataTransfer)

            e.dataTransfer = e.originalEvent.dataTransfer;

            files = e.dataTransfer.files;
            if (files.length > 1) {
                alert('í•˜ë‚˜ë§Œ ì˜¬ë ¤ë¼.');
                return;
            }

            if (files[0].type.match(/image.*/)) {
                $('#modal_add_feed_content').css({
                    display : 'flex'
                });
                $('.modal_image_upload_content').css({
                    "background-image": "url(" + window.URL.createObjectURL(files[0]) + ")",
                    "outline": "none",
                    "background-size": "cover",
                    "background-repeat" : "no-repeat",
                    "background-position" : "center",
                });
                $('#md_ad_fd').css({
                    display: 'none'
                });
            }
            else{
                alert('ì´ë¯¸ì§€ê°€ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }
        };

        $('#button_write_feed').on('click', ()=>{
            const image = $('#input_image').css("background-image").replace(/^url\(['"](.+)['"]\)/, '$1');
            const content = $('#input_content').val();
            const tag = $('#input_tag').val();

            const file = files[0];

            let fd = new FormData();

            fd.append('file', file);
            fd.append('image', image);
            fd.append('content', content);
            fd.append('tag', tag);

            if(image.length <= 0)
            {
                alert("ì´ë¯¸ì§€ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
            }
            else if(content.length <= 0)
            {
                alert("ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”");
            }
            else if(tag.length <= 0)
            {
                alert("íƒœê·¸ê°€ ì—†ìŠµë‹ˆë‹¤.");
            }
            else{
                writeFeed(fd);
                console.log(files[0]);
            }
        });

        function writeFeed(fd) {
            $.ajax({
                url: "/content/upload",
                data: fd,
                method: "POST",
                processData: false,
                contentType: false,
                complete: function() {
                    console.log("ë¬´ì¡°ê±´ì‹¤í–‰");
                    closeModal();
                    location.reload();
                }
            });
        }
        </script>
        <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
         <script>
            Kakao.init('34a42f89b6f3be1ac249349e26a2ea1f'); //6ë²ˆ í•­ëª©ì—ì„œ ë°œê¸‰ ë°›ì•˜ë˜ javascript keyë¥¼ ì—¬ê¸°ì— ë„£ëŠ”ë‹¤.

         $("#btn").click(function(e) { //jqueryë¥¼ ì‚¬ìš©í•œë‹¤ ê°€ì •
          e.preventDefault();   //ì´ë²¤íŠ¸ ë²„ë¸”ë§ prevent

          Kakao.Link.sendCustom({
            templateId: 72730   // 15ë²ˆ í•­ëª©ì—ì„œ í™•ì¸í•˜ì˜€ë˜ ì´ë²¤íŠ¸ë²ˆí˜¸ ë“±ë¡
          });
         });
          </script>
        {% endblock script-block %}